<<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=1920, height=1080" />
  <title>Friendship Heights Events (Signage)</title>
  <style>
    :root{ --pad-x:60px; --pad-y:40px; --gap:30px; --r:16px; }
    body{ margin:0; background:#fff; font-family:Arial,Helvetica,sans-serif; }
    .wrapper{ padding:var(--pad-y) var(--pad-x); }
    .header{ display:flex; align-items:center; margin-bottom:40px; }
    .header img{ height:90px; margin-right:30px; }
    .header h1{ font-size:42px; margin:0; }
    .month{ font-size:36px; margin:35px 0 20px; }
    .grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:var(--gap); }
    .card{ position:relative; border-radius:var(--r); overflow:hidden; background:#eee; }
    .card img{ width:100%; height:360px; object-fit:cover; display:block; }
    .overlay{ position:absolute; inset:0; background:linear-gradient(to bottom, rgba(0,0,0,.15), rgba(0,0,0,.75)); }
    .content{ position:absolute; left:20px; right:20px; bottom:20px; color:#fff; }
    .content h2{ font-size:26px; margin:0 0 10px; line-height:1.15; text-shadow:0 1px 2px rgba(0,0,0,.35); }
    .meta{ font-size:18px; line-height:1.25; text-shadow:0 1px 2px rgba(0,0,0,.35); }
    .badge{ position:absolute; top:15px; left:15px; background:#007bff; color:#fff; padding:6px 12px; border-radius:8px; font-size:14px; font-weight:700; z-index:3; box-shadow:0 2px 8px rgba(0,0,0,.25); }
    .status{ font-size:22px; margin-top:18px; max-width:1200px; line-height:1.35; }
    .tiny{ font-size:16px; opacity:.85; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <img src="https://friendshipheightsmd.gov/wp-content/uploads/2023/07/fh-logo.png" alt="FH logo">
      <h1>Friendship Heights Village Events Calendar</h1>
    </div>
    <div id="root">
      <div class="status">Loading events…</div>
      <div class="tiny">This page reads a local <code>events.json</code> file generated by GitHub Actions.</div>
    </div>
  </div>

<script>
const CONFIG = {
  // If events.json was built by HTML scraping, dates may be approximate.
  // So we can display a single "Upcoming Events" grid reliably.
  showSingleSection: true,
  totalCards: 6,
  timezone: "America/New_York"
};


const FALLBACK_IMAGE =
  "data:image/svg+xml;charset=utf-8," +
  encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">
      <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0" stop-color="#e9e9e9"/><stop offset="1" stop-color="#d9d9d9"/>
      </linearGradient></defs>
      <rect width="100%" height="100%" fill="url(#g)"/>
      <text x="50%" y="52%" text-anchor="middle" font-family="Arial" font-size="44" fill="#666">
        Friendship Heights Event
      </text>
    </svg>
  `);

function safe(s){ return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"); }

function fmtMonthKey(d){
  return new Intl.DateTimeFormat("en-US",{month:"long",year:"numeric",timeZone:CONFIG.timezone}).format(d);
}
function fmtDateTime(start,end){
  const dateFmt = new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"numeric",timeZone:CONFIG.timezone});
  const timeFmt = new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",timeZone:CONFIG.timezone});
  const day = dateFmt.format(start);
  const st = timeFmt.format(start), et = timeFmt.format(end);
  const looksAllDay = (st==="12:00 AM" && et==="12:00 AM");
  if (looksAllDay) return `${day} · All day`;
  return `${day} · ${st}–${et}`;
}
function isNextUp(start){
  const now = new Date();
  const diff = start - now;
  return diff >= 0 && diff <= 36*60*60*1000;
}

function render(events, generatedAt){
  // Sort by start date (best effort)
  events.sort((a,b)=> new Date(a.start) - new Date(b.start));

  const root = document.getElementById("root");
  root.innerHTML = "";

  if (!events.length){
    root.innerHTML = `<div class="status">No upcoming events found.</div>`;
    return;
  }

  // Single reliable section (recommended for scrape-based feed)
  const h = document.createElement("div");
  h.className = "month";
  h.textContent = "Upcoming Events";
  root.appendChild(h);

  const grid = document.createElement("div");
  grid.className = "grid";

  const items = events.slice(0, CONFIG.totalCards || 6);

  for (const ev of items){
    const start = new Date(ev.start);
    const end = new Date(ev.end || ev.start);
    const imgSrc = ev.image || FALLBACK_IMAGE;
    const badge = isNextUp(start) ? `<div class="badge">Next Up</div>` : "";

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      ${badge}
      <img src="${safe(imgSrc)}" alt="">
      <div class="overlay"></div>
      <div class="content">
        <h2>${safe(ev.title)}</h2>
        <div class="meta">${safe(fmtDateTime(start,end))}${ev.venue ? " · " + safe(ev.venue) : ""}</div>
      </div>
    `;
    const img = card.querySelector("img");
    img.addEventListener("error", ()=>{ img.src = FALLBACK_IMAGE; }, {once:true});
    grid.appendChild(card);
  }

  root.appendChild(grid);

  const foot = document.createElement("div");
  foot.className = "tiny";
  foot.innerHTML = `Updated: ${safe(new Date(generatedAt || Date.now()).toLocaleString("en-US",{timeZone:CONFIG.timezone}))}`;
  root.appendChild(foot);
}


async function main(){
  try{
    const res = await fetch("./events.json", {cache:"no-store"});
    if (!res.ok) throw new Error("events.json not found yet");
    const data = await res.json();
    render(data.events || [], data.generated_at);
  } catch(e){
    document.getElementById("root").innerHTML = `
      <div class="status">Events feed not ready yet.</div>
      <div class="tiny">This usually means GitHub Actions hasn’t generated <code>events.json</code> yet. After you add the workflow below, wait for the first run (or run it manually) and refresh.</div>
    `;
  }
}
main();
</script>
</body>
</html>
